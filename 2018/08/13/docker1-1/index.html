<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />

    

    
    <title>docker1 | Master</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="" />
    
    <meta name="description" content="Installation and Configuration Version 차이점사전 준비yum repository 를 업데이트하기 위한 Utility 등을 사용하기 리눅스 device mapper 및 lvm2 1[root@automan1 /]# yum install -y yum-utils device-mapper-persistent-data lvm2 docke">
<meta property="og:type" content="article">
<meta property="og:title" content="docker1">
<meta property="og:url" content="http://yoursite.com/2018/08/13/docker1-1/index.html">
<meta property="og:site_name" content="Master">
<meta property="og:description" content="Installation and Configuration Version 차이점사전 준비yum repository 를 업데이트하기 위한 Utility 등을 사용하기 리눅스 device mapper 및 lvm2 1[root@automan1 /]# yum install -y yum-utils device-mapper-persistent-data lvm2 docke">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://yoursite.com/2018/08/13/docker1-1/images/docker1.PNG">
<meta property="og:updated_time" content="2018-08-13T08:08:33.265Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="docker1">
<meta name="twitter:description" content="Installation and Configuration Version 차이점사전 준비yum repository 를 업데이트하기 위한 Utility 등을 사용하기 리눅스 device mapper 및 lvm2 1[root@automan1 /]# yum install -y yum-utils device-mapper-persistent-data lvm2 docke">
<meta name="twitter:image" content="http://yoursite.com/2018/08/13/docker1-1/images/docker1.PNG">
    

    
        <link rel="alternate" href="/" title="Master" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/titillium-web/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/3.3.1/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    


    <link rel="stylesheet" href="https://cdn.rawgit.com/innks/NanumSquareRound/master/nanumsquareround.css">

</head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">Home</a>
                                </li>
                            
                                        <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Container/">Container</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Container/Docker/">Docker</a></li></ul></li></ul>
                                    
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/about/index.html">About</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/Container/">Container</a><i class="icon fa fa-angle-right"></i><a class="page-title-link" href="/categories/Container/Docker/">Docker</a>
    </h1>
</div>
                        <div class="main-body-content">
                            <article id="post-docker1-1" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        docker1
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
        <a href="/2018/08/13/docker1-1/" class="article-date">
            <time datetime="2018-08-13T04:40:12.000Z" itemprop="datePublished">2018-08-13</time>
        </a>
    </div>

                
            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <h1 id="Installation-and-Configuration"><a href="#Installation-and-Configuration" class="headerlink" title="Installation and Configuration"></a>Installation and Configuration</h1><hr>
<h3 id="Version-차이점"><a href="#Version-차이점" class="headerlink" title="Version 차이점"></a>Version 차이점</h3><h3 id="사전-준비"><a href="#사전-준비" class="headerlink" title="사전 준비"></a>사전 준비</h3><p>yum repository 를 업데이트하기 위한 Utility 등을 사용하기</p>
<p>리눅스 device mapper 및 lvm2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@automan1 /]<span class="comment"># yum install -y yum-utils device-mapper-persistent-data lvm2</span></span><br></pre></td></tr></table></figure>
<p>docker repository 추가</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@automan1 /]<span class="comment"># yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span></span><br></pre></td></tr></table></figure>
<p>docker 인스톨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@automan1 /]<span class="comment"># yum install docker-ce</span></span><br></pre></td></tr></table></figure>
<p>docker service start and check status</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]<span class="comment"># systemctl enable docker &amp;&amp; systemctl start docker &amp;&amp; systemctl status docker</span></span><br><span class="line">● docker.service - Docker Application Container Engine</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Wed 2018-01-03 23:53:59 UTC; 6min ago</span><br><span class="line">     Docs: https://docs.docker.com</span><br><span class="line"> Main PID: 1105 (dockerd)</span><br><span class="line">   CGroup: /system.slice/docker.service</span><br><span class="line">           ├─1105 /usr/bin/dockerd</span><br><span class="line">           └─1129 docker-containerd --config /var/run/docker/containerd/containerd.tom...</span><br><span class="line"></span><br><span class="line">Jan 03 23:53:58 automan1.mylabserver.com dockerd[1105]: time=<span class="string">"2018-01-03T23:53:58.416..."</span></span><br><span class="line">Jan 03 23:53:58 automan1.mylabserver.com dockerd[1105]: time=<span class="string">"2018-01-03T23:53:58.438..."</span></span><br><span class="line">Jan 03 23:53:58 automan1.mylabserver.com dockerd[1105]: time=<span class="string">"2018-01-03T23:53:58.496..."</span></span><br><span class="line">Jan 03 23:53:58 automan1.mylabserver.com dockerd[1105]: time=<span class="string">"2018-01-03T23:53:58.499..."</span></span><br><span class="line">Jan 03 23:53:59 automan1.mylabserver.com dockerd[1105]: time=<span class="string">"2018-01-03T23:53:59.386..."</span></span><br><span class="line">Jan 03 23:53:59 automan1.mylabserver.com dockerd[1105]: time=<span class="string">"2018-01-03T23:53:59.477..."</span></span><br><span class="line">Jan 03 23:53:59 automan1.mylabserver.com dockerd[1105]: time=<span class="string">"2018-01-03T23:53:59.563...e</span></span><br><span class="line"><span class="string">Jan 03 23:53:59 automan1.mylabserver.com dockerd[1105]: time="</span>2018-01-03T23:53:59.564...<span class="string">"</span></span><br><span class="line"><span class="string">Jan 03 23:53:59 automan1.mylabserver.com dockerd[1105]: time="</span>2018-01-03T23:53:59.575...<span class="string">"</span></span><br><span class="line"><span class="string">Jan 03 23:53:59 automan1.mylabserver.com systemd[1]: Started Docker Application Conta....</span></span><br><span class="line"><span class="string">Hint: Some lines were ellipsized, use -l to show in full.</span></span><br></pre></td></tr></table></figure>
<p>일반 사용자에게 권한 부여하기</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[user@test1 ~]$ docker images</span><br><span class="line">Got permission denied <span class="keyword">while</span> trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.35/images/json: dial unix /var/run/docker.sock: connect: permission denied</span><br><span class="line"></span><br><span class="line">[user@test1 ~]$ sudo ls -al /var/run/docker.sock</span><br><span class="line">[sudo] password <span class="keyword">for</span> user:</span><br><span class="line">srw-rw----. 1 root docker 0 Jan  3 23:53 /var/run/docker.sock</span><br><span class="line"></span><br><span class="line">[user@test1 ~]$ sudo usermod -aG docker user</span><br><span class="line"></span><br><span class="line">[user@test1 ~]$ <span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line">[user@test1 ~]$ docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br></pre></td></tr></table></figure>
<h3 id="Ubuntu에서-실행하기"><a href="#Ubuntu에서-실행하기" class="headerlink" title="Ubuntu에서 실행하기"></a>Ubuntu에서 실행하기</h3><p>관련 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user@test2:~$ sudo apt-get install apt-transport-https ca-certificates curl software-properties-common</span><br></pre></td></tr></table></figure>
<p>repository 추가</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user@test2:~$ sudo add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot;</span><br><span class="line"></span><br><span class="line">user@test2:~$ sudo apt-get update</span><br></pre></td></tr></table></figure>
<p>docker installation</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user@test2:~$ sudo apt-get install docker-ce</span><br></pre></td></tr></table></figure>
<p>일반 사용자에게 권한 부여 하기</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">user@test2:~$ sudo ls -al /var/run/docker.sock</span><br><span class="line">srw-rw---- 1 root docker 0 Jan  3 23:54 /var/run/docker.sock</span><br><span class="line"></span><br><span class="line">user@test2:~$ sudo usermod -aG docker user</span><br><span class="line">user@test2:~$ exit</span><br><span class="line"></span><br><span class="line">user@test2:~$ docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br></pre></td></tr></table></figure>
<h3 id="Selecting-Storage-Driver"><a href="#Selecting-Storage-Driver" class="headerlink" title="Selecting Storage Driver"></a>Selecting Storage Driver</h3><p>Storage Driver를 바꾸면 기존에 다운로드 되어 있던 image들은 모두 날라가게 되니 조심 할것.</p>
<h3 id="Configuring-Logging-Drivers-Syslog-JSON-File-etc"><a href="#Configuring-Logging-Drivers-Syslog-JSON-File-etc" class="headerlink" title="Configuring Logging Drivers (Syslog, JSON-File, etc)"></a>Configuring Logging Drivers (Syslog, JSON-File, etc)</h3><p>현재 default Logging Driver 확인</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 docker]# docker system info | grep &quot;Logging&quot;</span><br><span class="line">WARNING: devicemapper: usage of loopback devices is strongly discouraged for production use.</span><br><span class="line">         Use `--storage-opt dm.thinpooldev` to specify a custom block storage device.</span><br><span class="line">Logging Driver: json-file</span><br></pre></td></tr></table></figure>
<p>현재는 Json-file인데 logging server는 system log로 변경</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 docker]# vi daemon.json</span><br><span class="line">&#123;</span><br><span class="line">        &quot;storage-driver&quot;: &quot;devicemapper&quot;,</span><br><span class="line">        &quot;log-driver&quot;: &quot;syslog&quot;,</span><br><span class="line">        &quot;log-opts&quot;: &#123;</span><br><span class="line">                &quot;labels&quot;: &quot;status&quot;,</span><br><span class="line">                &quot;env&quot;: &quot;production&quot;</span><br><span class="line">                &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@test1 docker]# systemctl restart docker</span><br><span class="line"></span><br><span class="line">[root@test1 docker]# docker system info | grep &quot;Logging&quot;</span><br><span class="line">WARNING: devicemapper: usage of loopback devices is strongly discouraged for production use.</span><br><span class="line">         Use `--storage-opt dm.thinpooldev` to specify a custom block storage device.</span><br><span class="line">Logging Driver: syslog</span><br></pre></td></tr></table></figure>
<p>docker image 생성</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 docker]# docker pull httpd</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/httpd</span><br><span class="line">f49cf87b52c1: Pull complete</span><br><span class="line">02ca099fb6cd: Pull complete</span><br><span class="line">de7acb18da57: Pull complete</span><br><span class="line">770c8edb393d: Pull complete</span><br><span class="line">0e252730aeae: Pull complete</span><br><span class="line">6e6ca341873f: Pull complete</span><br><span class="line">2daffd0a6144: Pull complete</span><br><span class="line">Digest: sha256:b5f21641a9d7bbb59dc94fb6a663c43fbf3f56270ce7c7d51801ac74d2e70046</span><br><span class="line">Status: Downloaded newer image for httpd:latest</span><br><span class="line"></span><br><span class="line">[root@test1 docker]# docker iamges</span><br><span class="line">docker: &apos;iamges&apos; is not a docker command.</span><br><span class="line">See &apos;docker --help&apos;</span><br><span class="line">[root@test1 docker]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">httpd               latest              7239615c0645        3 weeks ago         177MB</span><br><span class="line">hello-world         latest              f2a91732366c        6 weeks ago         1.85kB</span><br><span class="line"></span><br><span class="line">[root@test1 docker]# docker run -d httpd</span><br><span class="line">638884c6269c37ddaecff1ea75e4f0c2f71991a32a741946c14c6f8686248de9</span><br><span class="line"></span><br><span class="line">[root@test1 docker]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND              CREATED             STATUS              PORTS               NAMES</span><br><span class="line">638884c6269c        httpd               &quot;httpd-foreground&quot;   8 seconds ago       Up 6 seconds        80/tcp              wizardly_poitras</span><br><span class="line"></span><br><span class="line">[root@test1 docker]# docker container inspect wizardly_poitras | grep IPAdd</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line"></span><br><span class="line">[root@test1 docker]# docker container logs wizardly_poitras</span><br><span class="line">Error response from daemon: configured logging driver does not support reading</span><br></pre></td></tr></table></figure>
<p>log를 확인해보자 먼저 default  option인 jsonfile를 포멧을 확인한다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 docker]# docker stop wizardly_poitras</span><br><span class="line"></span><br><span class="line">[root@test1 docker]# docker run -d --log-driver json-file httpd</span><br><span class="line"></span><br><span class="line">[root@test1 docker]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND              CREATED             STATUS              PORTS               NAMES</span><br><span class="line">502c3ec26f84        httpd               &quot;httpd-foreground&quot;   5 minutes ago       Up 5 minutes        80/tcp              reverent_mayer</span><br><span class="line"></span><br><span class="line">[root@test1 docker]# docker container inspect reverent_mayer | grep IPAdd</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line"></span><br><span class="line">[root@test1 docker]# lynx http://172.17.0.2</span><br><span class="line"></span><br><span class="line">[root@test1 docker]# docker container logs reverent_mayer</span><br><span class="line">AH00558: httpd: Could not reliably determine the server&apos;s fully qualified domain name, using 172.17.0.2. Set the &apos;ServerName&apos; directive globally to suppress this message</span><br><span class="line">AH00558: httpd: Could not reliably determine the server&apos;s fully qualified domain name, using 172.17.0.2. Set the &apos;ServerName&apos; directive globally to suppress this message</span><br><span class="line">[Sun Jan 07 05:40:49.649582 2018] [mpm_event:notice] [pid 1:tid 140716881528704] AH00489: Apache/2.4.29 (Unix) configured -- resuming normal operations</span><br><span class="line">[Sun Jan 07 05:40:49.654325 2018] [core:notice] [pid 1:tid 140716881528704] AH00094: Command line: &apos;httpd -D FOREGROUND&apos;</span><br><span class="line">172.17.0.1 - - [07/Jan/2018:05:43:36 +0000] &quot;GET / HTTP/1.0&quot; 200 45</span><br></pre></td></tr></table></figure>
<p>logging driver를 json에서 syslog로 바꿔보자</p>
<p>현재 Syslog를 사용할 수 있도록 환경 설정을 한다. 아래 두가지 옵션을 활성화 하자</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@automan1 ~]# cd /etc</span><br><span class="line">[root@automan1 etc]# vim rsyslog.conf</span><br><span class="line"></span><br><span class="line">$ModLoad imudp</span><br><span class="line">$UDPServerRun 514</span><br><span class="line"></span><br><span class="line">[root@automan1 etc]# systemctl start rsyslog</span><br><span class="line">[root@automan1 etc]# systemctl status rsyslog</span><br><span class="line">● rsyslog.service - System Logging Service</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/rsyslog.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Sat 2018-06-30 05:12:10 UTC; 1h 5min ago</span><br><span class="line">     Docs: man:rsyslogd(8)</span><br><span class="line">           http://www.rsyslog.com/doc/</span><br><span class="line"> Main PID: 1072 (rsyslogd)</span><br><span class="line">    Tasks: 3</span><br><span class="line">   Memory: 76.0K</span><br><span class="line">   CGroup: /system.slice/rsyslog.service</span><br><span class="line">           └─1072 /usr/sbin/rsyslogd -n</span><br><span class="line"></span><br><span class="line">Jun 30 05:12:09 automan1.mylabserver.com systemd[1]: Starting System Logging Service...</span><br><span class="line">Jun 30 05:12:10 automan1.mylabserver.com rsyslogd[1072]:  [origin software=&quot;rsyslogd&quot; s...t</span><br><span class="line">Jun 30 05:12:10 automan1.mylabserver.com systemd[1]: Started System Logging Service.</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show in full.</span><br></pre></td></tr></table></figure>
<p>syslog를 활용 할 수 있도록 docker 환경 설정을 한다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@automan1 docker]# vim daemon.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">        &quot;storage-driver&quot;: &quot;devicemapper&quot;,</span><br><span class="line">        &quot;log-driver&quot;: &quot;syslog&quot;,</span><br><span class="line">        &quot;log-opts&quot;: &#123;</span><br><span class="line">                &quot;syslog-address&quot;:&quot;udp://localhost:514&quot;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@automan1 docker]# docker info | grep Logging</span><br><span class="line">WARNING: devicemapper: usage of loopback devices is strongly discouraged for production use.</span><br><span class="line">         Use `--storage-opt dm.thinpooldev` to specify a custom block storage device.</span><br><span class="line">Logging Driver: syslog</span><br></pre></td></tr></table></figure>
<p>이상태에서 local 혹은 remote 머신의 syslog를 구동해보자</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@automan1 docker]# echo &quot;&quot; &gt; /var/log/messages</span><br><span class="line">[root@automan1 docker]# systemctl restart rsyslog</span><br><span class="line">[root@automan1 docker]# tail -f /var/log/messages</span><br><span class="line"></span><br><span class="line">Jun 30 06:27:53 automan1 systemd: Stopping System Logging Service...</span><br><span class="line">Jun 30 06:27:53 automan1 rsyslogd: [origin software=&quot;rsyslogd&quot; swVersion=&quot;8.24.0&quot; x-pid=&quot;1072&quot; x-info=&quot;http://www.rsyslog.com&quot;] exiting on signal 15.</span><br><span class="line">Jun 30 06:27:53 automan1 systemd: Starting System Logging Service...</span><br><span class="line">Jun 30 06:27:53 automan1 rsyslogd: [origin software=&quot;rsyslogd&quot; swVersion=&quot;8.24.0&quot; x-pid=&quot;6636&quot; x-info=&quot;http://www.rsyslog.com&quot;] start</span><br></pre></td></tr></table></figure>
<p>이 상태에서 터미널을 하나 더 열어서 docker image를 하나 구동 해보자</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[user@automan1 ~]$ docker run -d --name=testweb -p 80:80 httpd</span><br><span class="line">d4d5e3ff2f1a3b27618fc1cc10f86a6c456f96611fd66dc4d12f2eab760671d2</span><br></pre></td></tr></table></figure>
<p>syslog에 docker 이미지 실행에 대한 로그를 확인 할 수 있다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Jun 30 06:30:25 automan1 kernel: XFS (dm-1): Mounting V4 Filesystem</span><br><span class="line">Jun 30 06:30:25 automan1 kernel: XFS (dm-1): Ending clean mount</span><br><span class="line">Jun 30 06:30:25 automan1 kernel: XFS (dm-1): Unmounting Filesystem</span><br><span class="line">Jun 30 06:30:25 automan1 kernel: XFS (dm-1): Mounting V4 Filesystem</span><br><span class="line">Jun 30 06:30:25 automan1 kernel: XFS (dm-1): Ending clean mount</span><br><span class="line">Jun 30 06:30:25 automan1 kernel: XFS (dm-1): Unmounting Filesystem</span><br><span class="line">Jun 30 06:30:25 automan1 kernel: XFS (dm-1): Mounting V4 Filesystem</span><br><span class="line">Jun 30 06:30:25 automan1 kernel: XFS (dm-1): Ending clean mount</span><br><span class="line">Jun 30 06:30:25 automan1 kernel: docker0: port 1(veth2463cb6) entered blocking state</span><br><span class="line">Jun 30 06:30:25 automan1 kernel: docker0: port 1(veth2463cb6) entered disabled state</span><br><span class="line">Jun 30 06:30:26 automan1 kernel: device veth2463cb6 entered promiscuous mode</span><br><span class="line">Jun 30 06:30:26 automan1 kernel: IPv6: ADDRCONF(NETDEV_UP): veth2463cb6: link is not ready</span><br><span class="line">Jun 30 06:30:26 automan1 kernel: docker0: port 1(veth2463cb6) entered blocking state</span><br><span class="line">Jun 30 06:30:26 automan1 kernel: docker0: port 1(veth2463cb6) entered forwarding state</span><br><span class="line">Jun 30 06:30:26 automan1 kernel: docker0: port 1(veth2463cb6) entered disabled state</span><br><span class="line">Jun 30 06:30:26 automan1 NetworkManager[664]: &lt;info&gt;  [1530340226.0424] manager: (vethf399284): new Veth device (/org/freedesktop/NetworkManager/Devices/7)</span><br><span class="line">Jun 30 06:30:26 automan1 NetworkManager[664]: &lt;info&gt;  [1530340226.0457] manager: (veth2463cb6): new Veth device (/org/freedesktop/NetworkManager/Devices/8)</span><br><span class="line">Jun 30 06:30:26 automan1 dockerd: time=&quot;2018-06-30T06:30:26Z&quot; level=info msg=&quot;shim docker-containerd-shim started&quot; address=&quot;/containerd-shim/moby/d4d5e3ff2f1a3b27618fc1cc10f86a6c456f96611fd66dc4d12f2eab760671d2/shim.sock&quot; debug=false module=&quot;containerd/tasks&quot; pid=7087</span><br><span class="line">Jun 30 06:30:26 automan1 avahi-daemon[592]: Withdrawing workstation service for vethf399284.</span><br><span class="line">Jun 30 06:30:26 automan1 kernel: IPv6: ADDRCONF(NETDEV_CHANGE): veth2463cb6: link becomes ready</span><br><span class="line">Jun 30 06:30:26 automan1 kernel: docker0: port 1(veth2463cb6) entered blocking state</span><br><span class="line">Jun 30 06:30:26 automan1 kernel: docker0: port 1(veth2463cb6) entered forwarding state</span><br><span class="line">Jun 30 06:30:26 automan1 NetworkManager[664]: &lt;info&gt;  [1530340226.2206] device (veth2463cb6): carrier: link connected</span><br><span class="line">Jun 30 06:30:26 automan1 NetworkManager[664]: &lt;info&gt;  [1530340226.2374] device (docker0): carrier: link connected</span><br><span class="line">Jun 30 06:30:26 localhost d4d5e3ff2f1a[6293]: AH00558: httpd: Could not reliably determine the server&apos;s fully qualified domain name, using 172.17.0.2. Set the &apos;ServerName&apos; directive globally to suppress this message</span><br><span class="line">Jun 30 06:30:26 localhost d4d5e3ff2f1a[6293]: AH00558: httpd: Could not reliably determine the server&apos;s fully qualified domain name, using 172.17.0.2. Set the &apos;ServerName&apos; directive globally to suppress this message</span><br><span class="line">Jun 30 06:30:26 localhost d4d5e3ff2f1a[6293]: [Sat Jun 30 06:30:26.323447 2018] [mpm_event:notice] [pid 1:tid 140124613404544] AH00489: Apache/2.4.33 (Unix) configured -- resuming normal operations</span><br><span class="line">Jun 30 06:30:26 localhost d4d5e3ff2f1a[6293]: [Sat Jun 30 06:30:26.329674 2018] [core:notice] [pid 1:tid 140124613404544] AH00094: Command line: &apos;httpd -D FOREGROUND&apos;</span><br><span class="line">Jun 30 06:30:28 automan1 avahi-daemon[592]: Registering new address record for fe80::10eb:61ff:fe31:d742 on veth2463cb6.*.</span><br><span class="line">Jun 30 06:30:46 automan1 amazon-ssm-agent: 2018-06-30 06:30:46 INFO [HealthCheck] HealthCheck reporting agent health.</span><br></pre></td></tr></table></figure>
<p>로그를 통해 ‘httpd -D FOREGROUND’ 와 같이 foregroud로 실행된 것을 알 수 있다.</p>
<p>이제 간단하게 웹사이트에 접속해보고 log에 어떻게 찍히는지 확이해보자</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[user@automan1 ~]$ curl http://localhost</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span><br><span class="line">[user@automan1 ~]$ curl http://localhost</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">Jun 30 06:38:12 localhost d4d5e3ff2f1a[6293]: 172.17.0.1 - - [30/Jun/2018:06:38:12 +0000] &quot;GET / HTTP/1.1&quot; 200 45</span><br><span class="line">Jun 30 06:38:21 localhost d4d5e3ff2f1a[6293]: 172.17.0.1 - - [30/Jun/2018:06:38:21 +0000] &quot;GET / HTTP/1.1&quot; 200 45</span><br></pre></td></tr></table></figure>
<p>만일 특정 컨테이너에 대해 Syslog가 아닌 json 포멧으로 로그를 남기고 싶다면 아래와 같이 컨테이너 실행시 logging option을 지정할 수 있다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@automan1 docker]# docker run -d --name testjson --log-driver json-file httpd</span><br><span class="line"></span><br><span class="line">[root@automan1 docker]# docker logs testjson</span><br><span class="line">AH00558: httpd: Could not reliably determine the server&apos;s fully qualified domain name, using 172.17.0.2. Set the &apos;ServerName&apos; directive globally to suppress this message</span><br><span class="line">AH00558: httpd: Could not reliably determine the server&apos;s fully qualified domain name, using 172.17.0.2. Set the &apos;ServerName&apos; directive globally to suppress this message</span><br><span class="line">[Sat Jun 30 06:43:33.764925 2018] [mpm_event:notice] [pid 1:tid 140063915788160] AH00489: Apache/2.4.33 (Unix) configured -- resuming normal operations</span><br><span class="line">[Sat Jun 30 06:43:33.771181 2018] [core:notice] [pid 1:tid 140063915788160] AH00094: Command line: &apos;httpd -D FOREGROUND&apos;</span><br></pre></td></tr></table></figure>
<h3 id="Setup-swarm-configure-managers-add-nodes-and-setup-backup-schedule"><a href="#Setup-swarm-configure-managers-add-nodes-and-setup-backup-schedule" class="headerlink" title="Setup swarm, configure managers, add nodes, and setup backup schedule"></a>Setup swarm, configure managers, add nodes, and setup backup schedule</h3><h4 id="Configure-Manager"><a href="#Configure-Manager" class="headerlink" title="Configure Manager"></a>Configure Manager</h4><p>기존에 다운로드한 이미지를 모두 삭제</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">httpd               latest              7239615c0645        3 weeks ago         177MB</span><br><span class="line">hello-world         latest              f2a91732366c        6 weeks ago         1.85kB</span><br><span class="line"></span><br><span class="line">[root@test1 ~]# docker rmi 7239615c0645</span><br><span class="line">[root@test1 ~]# docker rmi f2a91732366c</span><br></pre></td></tr></table></figure>
<p>Docker Swarm에 대해서는 추후에 자세히 살펴보고, 우선 아래와 같이 설치를 해보자  설치는 Swarm을 수행할 서버의 IP address를 지정하면 된다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# docker swarm init --advertise-addr 172.31.22.17</span><br><span class="line">Swarm initialized: current node (umqocsykyg1xxsn6wvk4igx1k) is now a manager.</span><br><span class="line"></span><br><span class="line">To add a worker to this swarm, run the following command:</span><br><span class="line"></span><br><span class="line">    docker swarm join --token SWMTKN-1-5070xwlej15dop8d8d29do3l01z6tsfwyjwnkvi9pil0qubj8g-3fwsm8707uwu5yeb6n2o6ilpk 172.31.22.17:2377</span><br><span class="line"></span><br><span class="line">To add a manager to this swarm, run &apos;docker swarm join-token manager&apos; and follow the instructions.</span><br></pre></td></tr></table></figure>
<p>현재의 서버가 매니저가 되었다.</p>
<p>이제 관리할 worker들을 swarm에 join 시켜야 하는데, 위 커맨드의 실행결과에 나온 Token을 사용하여  worker node에서 실행 시켜 주면 swarm에 join 하게 된다.</p>
<p>더불어 복수의 manager node를 운영하고 싶을 경우 추가할 수 있는데 이 부분은 쿼럼 설명 때 자세히 하겠다.</p>
<p>일반적으로 Token은 공용 저장소등을 이용해 관리하게 되는데 잃어 버리더라고 당황하지 말자. 아래 명령을 이용하면 해당 Swarm에서 발급한 Token을 확인 할 수 있다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# docker swarm join-token worker</span><br><span class="line">To add a worker to this swarm, run the following command:</span><br><span class="line"></span><br><span class="line">    docker swarm join --token SWMTKN-1-5070xwlej15dop8d8d29do3l01z6tsfwyjwnkvi9pil0qubj8g-3fwsm8707uwu5yeb6n2o6ilpk 172.31.22.17:2377</span><br></pre></td></tr></table></figure>
<p>추후 manager  node를 추가 할 때는 아래와 같이 추가 manager node에 발급되는 Token을 확인 할 수 있다. 자세히 보면 토큰의 “-“ 뒷부분의 code가 worker와 다른 것을 확인 할 수 있다. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# docker swarm join-token manager</span><br><span class="line">To add a manager to this swarm, run the following command:</span><br><span class="line"></span><br><span class="line">    docker swarm join --token SWMTKN-1-5070xwlej15dop8d8d29do3l01z6tsfwyjwnkvi9pil0qubj8g-8j43t1kqsmbpo68eulvgvgahz 172.31.22.17:2377</span><br></pre></td></tr></table></figure>
<h4 id="Add-nodes"><a href="#Add-nodes" class="headerlink" title="Add nodes"></a>Add nodes</h4><p>현재 Swarm이 관리하고 있는 서버 현황을 살펴보자.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# docker node ls</span><br><span class="line">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS</span><br><span class="line">umqocsykyg1xxsn6wvk4igx1k *   test1               Ready               Active              Leader</span><br></pre></td></tr></table></figure>
<p>현재로써는 manager node인 test1 만 등록되어 있는것을 확인 할 수 있다. test1 node의  ID 값에 “*” 표시는 특별한 Node라는 표시이며 MANAGER STATUS에서 “Leader” 로 지정된 것을 확인 할 수 있다.</p>
<p>이제 worker node를 여기에 추가해보자. 우선 새로운 서버(test2)에서 위 1.1번에서 진행했던 방식대로 docker를 설치한다. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@test2 ~]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br></pre></td></tr></table></figure>
<p>자 이제 그럼 test1번 서버에서 worker를 join 시키기위한 Token을 다시 한번 확인 해보자</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# docker swarm join-token worker</span><br><span class="line">To add a worker to this swarm, run the following command:</span><br><span class="line"></span><br><span class="line">    docker swarm join --token SWMTKN-1-5070xwlej15dop8d8d29do3l01z6tsfwyjwnkvi9pil0qubj8g-3fwsm8707uwu5yeb6n2o6ilpk 172.31.22.17:2377</span><br></pre></td></tr></table></figure>
<p>실행된 결과에서 “docker swarm join –token SWMTKN-1-….” 라인을 copy하여 test2 와 test3 서버에서 실행한다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@test2 ~]# docker swarm join --token SWMTKN-1-5070xwlej15dop8d8d29do3l01z6tsfwyjwnkvi9pil0qub</span><br><span class="line">j8g-3fwsm8707uwu5yeb6n2o6ilpk 172.31.22.17:2377</span><br><span class="line">This node joined a swarm as a worker.</span><br><span class="line"></span><br><span class="line">[root@test3 ~]# docker swarm join --token SWMTKN-1-5070xwlej15dop8d8d29do3l01z6tsfwyjwnkvi9pil0qub</span><br><span class="line">j8g-3fwsm8707uwu5yeb6n2o6ilpk 172.31.22.17:2377</span><br><span class="line">This node joined a swarm as a worker</span><br></pre></td></tr></table></figure>
<p>실행 결과를 보면 worker로 swarm에 조인되었다는 메시지를 확인 할 수 있다. 실제로 swarm에 등록 되었는지 test1에서 확인해보자.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# docker node ls</span><br><span class="line">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS</span><br><span class="line">umqocsykyg1xxsn6wvk4igx1k *   test1               Ready               Active              Leader</span><br><span class="line">rugmetip3d1il2cokfqt1bx03     test2               Ready               Active</span><br><span class="line">zl4ujrl7uh38saoyu0r0i42pz     test3               Ready               Active</span><br><span class="line"></span><br><span class="line">[root@test1 ~]# docker system info | grep -A 6 Swarm</span><br><span class="line">Swarm: active</span><br><span class="line"> NodeID: umqocsykyg1xxsn6wvk4igx1k</span><br><span class="line"> Is Manager: true</span><br><span class="line"> ClusterID: 5j843ntmj4xr8djib232rekze</span><br><span class="line"> Managers: 1</span><br><span class="line"> Nodes: 3</span><br><span class="line"> Orchestration:</span><br></pre></td></tr></table></figure>
<p>위와 같이 node가 추가 된 것을 확인 할 수 있다.</p>
<h4 id="Swarm-Backup-and-Restore"><a href="#Swarm-Backup-and-Restore" class="headerlink" title="Swarm Backup and Restore"></a>Swarm Backup and Restore</h4><p>swarm manager node에서 httpd docker image를 하나 다운로드 받아 두자</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# docker pull httpd</span><br><span class="line">[root@test1 ~]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">httpd               latest              7239615c0645        3 weeks ago         177MB</span><br></pre></td></tr></table></figure>
<p>이제 swarm 클러스터의 woker node에  web service를 배포해보자</p>
<p>서비스 배포는 아래의 명령으로 수행 할 수있는 데 각 파라메터의 의미는 서비스 name은 test_web으로 서비스 port는 80, 그리고 클러스터내에 최소한 2개 이상의 node에 배포하고 docker image는 httpd를 사용한다는 의미이다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# docker service create --name test_web --publish 80:80 --replicas 2 httpd</span><br><span class="line">uj4blgm7ni3huwp0zuc36fysr</span><br><span class="line">overall progress: 2 out of 2 tasks</span><br><span class="line">1/2: running</span><br><span class="line">2/2: running</span><br><span class="line">verify: Service converged</span><br></pre></td></tr></table></figure>
<p>자 이제 web 서비스가 2대의 worker node에 배포가 되었다. 실제 배포가 잘되었는지 서비스 현황이 어떤지 다음의 명령으로 확인한다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# docker service ls</span><br><span class="line">ID                  NAME                MODE                REPLICAS            IMAGE               PORTS</span><br><span class="line">uj4blgm7ni3h        test_web            replicated          2/2                 httpd:latest        *:80-&gt;80/tcp</span><br><span class="line"></span><br><span class="line">[root@test1 ~]# docker service ps test_web</span><br><span class="line">ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE           ERROR               PORTS</span><br><span class="line">0s1c0k4ptuk3        test_web.1          httpd:latest        test2               Running             Running 5 minutes ago</span><br><span class="line">nozonu306ltq        test_web.2          httpd:latest        test1               Running             Running 5 minutes ago</span><br></pre></td></tr></table></figure>
<p>test_web 서비스가 test1, 2번 node에 배포되었고 실행중인것을 확인 할 수 있고,  실제 배포된 worker node 1번, 2번에 로그인 해서 상황을 봐도 잘 수행된것을 확인 할 수 있다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND              CREATED             STATUS              PORTS               NAMES</span><br><span class="line">36df35af0ac3        httpd:latest        &quot;httpd-foreground&quot;   8 minutes ago       Up 7 minutes        80/tcp              test_web.2.nozonu306ltq4pgwca76ar2e3</span><br><span class="line"></span><br><span class="line">[root@test2 ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND              CREATED             STATUS           </span><br><span class="line">   PORTS               NAMES</span><br><span class="line">fdca636fcbea        httpd:latest        &quot;httpd-foreground&quot;   7 minutes ago       Up 7 minutes        80/tcp              test_web.1.0s1c0k4ptuk3bcwak4pngxuux</span><br></pre></td></tr></table></figure>
<h4 id="Swarm-Backup"><a href="#Swarm-Backup" class="headerlink" title="Swarm Backup"></a>Swarm Backup</h4><p>swarm의 backup과 restore는 생각 보다 간단한데, swarm Cluster를 관리하는 모든 파일은 /var/lib/docker/swarm 디렉토리에 위치한다. 이 디렉토리를 별도의 공간에 주기적으로 backup하고 문제 발생시 디렉토리를 overwrite 해주면 문제 발생 이전 상황으로 되돌 릴 수 있다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# ll /var/lib/docker/swarm/</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x. 2 root root  72 Jan  7 05:59 certificates</span><br><span class="line">-rw-------. 1 root root 149 Jan  7 05:59 docker-state.json</span><br><span class="line">drwx------. 4 root root  53 Jan  7 05:59 raft</span><br><span class="line">-rw-------. 1 root root  68 Jan  7 05:59 state.json</span><br><span class="line">drwxr-xr-x. 2 root root  21 Jan  7 05:59 worker</span><br></pre></td></tr></table></figure>
<p>  파일들을 백업하기 위해 docker service를 중지하고 파일을 적정한 디렉토리로 copy 한 후 다시 docker service를 start 한다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# systemctl stop docker</span><br><span class="line">[root@test1 ~]# cp -rf /var/lib/docker/swarm/ .</span><br><span class="line">[root@test1 ~]# ll ./swarm/</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x. 2 root root  72 Jan  7 07:09 certificates</span><br><span class="line">-rw-------. 1 root root 149 Jan  7 07:09 docker-state.json</span><br><span class="line">drwx------. 4 root root  53 Jan  7 07:09 raft</span><br><span class="line">-rw-------. 1 root root  68 Jan  7 07:09 state.json</span><br><span class="line">drwxr-xr-x. 2 root root  21 Jan  7 07:09 worker</span><br><span class="line">[root@test1 ~]# systemctl start docker</span><br></pre></td></tr></table></figure>
<p>백업된 파일은 tar로 압축하여 적절한 원격지 서버로 copy 해 둔다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# tar cvzf swarm_backup_20171010.tar.gz ./swarm</span><br><span class="line">[root@test1 ~]# scp swarm_backup_20171010.tar.gz user@test2:/backup</span><br></pre></td></tr></table></figure>
<h4 id="Swarm-Restore"><a href="#Swarm-Restore" class="headerlink" title="Swarm Restore"></a>Swarm Restore</h4><p>자 이제 manager node가 crash 되어서 복구 불가하다고  가정 해보자. 이 상태에서는 새로운 Manager 서버를 만들어 swarm Cluster 를 복구 해야 할 것 이다. 이런 상황을  연출하기 위해 Swarm 내 모든 서버들의 docker 서비스를 중지 해보자. 이제 swarm cluster는 완전히 서비스가 중지된 상태이다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# systemctl stop docker</span><br><span class="line">[root@test2 ~]# systemctl stop docker</span><br><span class="line">[root@test3 ~]# systemctl stop docker</span><br></pre></td></tr></table></figure>
<p>먼저 새로운 manager node가 될 서버(test4)에 docker를 설치하고, /var/lib/docker/swarm/ 디렉토리를 삭제한 후 백업된 swarm file를 압축을 풀어 동일한 디렉토리에 copy 하자.</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@test4 ~]# systemctl stop docker</span><br><span class="line">[root@test4 ~]# rm -rf /var/lib/docker/swarm/</span><br><span class="line">[root@test4 ~]# ls /var/lib/docker/</span><br><span class="line">builder     containers    image    plugins   tmp    volumes</span><br><span class="line">containerd  devicemapper  network  runtimes  trust</span><br><span class="line">[root@test4 ~]# tar xvzf /tmp/swarm_backup_20171010.tar.gz -C /var/lib/docker/</span><br><span class="line">./swarm/</span><br><span class="line">./swarm/certificates/</span><br><span class="line">./swarm/certificates/swarm-root-ca.crt</span><br><span class="line">./swarm/certificates/swarm-node.key</span><br><span class="line">./swarm/certificates/swarm-node.crt</span><br><span class="line">./swarm/docker-state.json</span><br><span class="line">./swarm/worker/</span><br><span class="line">./swarm/worker/tasks.db</span><br><span class="line">./swarm/raft/</span><br><span class="line">./swarm/raft/snap-v3-encrypted/</span><br><span class="line">./swarm/raft/wal-v3-encrypted/</span><br><span class="line">./swarm/raft/wal-v3-encrypted/0000000000000000-0000000000000000.wal</span><br><span class="line">./swarm/state.json</span><br><span class="line">[root@test4 ~]# ls /var/lib/docker/</span><br><span class="line">builder     containers    image    plugins   swarm  trust</span><br><span class="line">containerd  devicemapper  network  runtimes  tmp    volumes</span><br></pre></td></tr></table></figure>
<p>이제 restore된 swarm 설정 파일로 docker를 다시 수행 하고 swarm cluster를 initialize 해보자</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@test4 ~]# systemctl start docker</span><br><span class="line">[root@test4 ~]# docker swarm init --force-new-cluster</span><br><span class="line">Swarm initialized: current node (umqocsykyg1xxsn6wvk4igx1k) is now a manager.</span><br><span class="line">To add a worker to this swarm, run the following command:</span><br><span class="line">    docker swarm join --token SWMTKN-1-5070xwlej15dop8d8d29do3l01z6tsfwyjwnkvi9pil0qubj8g-3fwsm870</span><br><span class="line">7uwu5yeb6n2o6ilpk 172.31.22.17:2377</span><br><span class="line">To add a manager to this swarm, run &apos;docker swarm join-token manager&apos; and follow the instructions.</span><br></pre></td></tr></table></figure>
<p>test4번이 새로운 manager가 되었다. 더불어 worker node를 추가 하기 위한 Token이 새로 생성된것이 아니라 이전에 사용하던 것임을 확인 할 수 있다.  </p>
<p>그럼 이전에 만들어 놓았다 Test_web 서비스가 살아 있는지 확인해보자</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@test4 ~]# docker service ls</span><br><span class="line">ID                  NAME                MODE                REPLICAS            IMAGE             </span><br><span class="line">  PORTS</span><br><span class="line">uj4blgm7ni3h        test_web            replicated          2/2                 httpd:latest      </span><br><span class="line">  *:80-&gt;80/tcp</span><br></pre></td></tr></table></figure>
<p>위와 같이 test_web 서비스가 2개의 복제본을 가지고 제대로 올라온 것을 확인 할 수 있다. 대상 worker node도 2번과 4번 을 지정했으나 2번 node가 down 상태이므로 4번 node에 2개를 모두 생성한 것을 확인 할 수 있다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@test4 ~]# docker service ps test_web</span><br><span class="line">ID                  NAME                IMAGE               NODE                DESIRED STATE     </span><br><span class="line">  CURRENT STATE               ERROR                              PORTS</span><br><span class="line">asi19jawpbrg        test_web.1          httpd:latest        test4               Running           </span><br><span class="line">  Running 3 minutes ago                                          </span><br><span class="line">kj8kzmnmf7yu         \_ test_web.1      httpd:latest        test4               Shutdown          </span><br><span class="line">  Complete 3 minutes ago                                         </span><br><span class="line">0s1c0k4ptuk3         \_ test_web.1      httpd:latest        test2               Shutdown          </span><br><span class="line">  Running about an hour ago                                      </span><br><span class="line">3ah4p185dwbx        test_web.2          httpd:latest        test4               Running           </span><br><span class="line">  Running 3 minutes ago                                          </span><br><span class="line">tvbs2saru75x         \_ test_web.2      httpd:latest        test4               Shutdown          </span><br><span class="line">  Complete 3 minutes ago                                         </span><br><span class="line">nozonu306ltq         \_ test_web.2      httpd:latest        test4               Shutdown          </span><br><span class="line">  Failed 5 minutes ago        &quot;No such container: test_web.2…&quot;</span><br></pre></td></tr></table></figure>
<h3 id="Outline-the-sizing-requirements-prior-to-installation"><a href="#Outline-the-sizing-requirements-prior-to-installation" class="headerlink" title="Outline the sizing requirements prior to installation"></a>Outline the sizing requirements prior to installation</h3><p>Cluster Sizing requirements</p>
<ul>
<li>CPU, Memory and Disk</li>
<li>Concurrency</li>
</ul>
<p>UCP(Universal Control Plane) System Requirements</p>
<p>Breakdown of Manager nodes for Fault Tolerance</p>
<p>Minimum Requirements</p>
<ul>
<li>8GB RAM (Manger or DTR nodes)</li>
<li>4GB RAM (Workers)</li>
<li>3GB Free Disk</li>
</ul>
<p>Recommended Requirement</p>
<ul>
<li>16GB RAM( Manager or DTR Nodes)</li>
<li>4vCPUs (Workers or DTR Nodes)</li>
<li>25-100GB Disk Space</li>
</ul>
<p>Performance Consideration (Timing)</p>
<p>Special Notes</p>
<p>Docker EE includes</p>
<ul>
<li>Docker Engine with support</li>
<li>Docker Trusted Registry</li>
<li>Universal Control Plane</li>
</ul>
<p>Compatibility </p>
<ul>
<li>Docker Engine 17.06+</li>
<li>DTR 2.3+</li>
<li>UCP 2.2+</li>
</ul>
<p>Recommendations</p>
<ul>
<li>plan for Load Balancing</li>
<li>User External Certificate Authority for production</li>
</ul>
<h3 id="Setup-and-Configure-Universal-Control-Plane-UCP-and-Docker-Trusted-Repository-DTR-for-Secure-Cluster-Management"><a href="#Setup-and-Configure-Universal-Control-Plane-UCP-and-Docker-Trusted-Repository-DTR-for-Secure-Cluster-Management" class="headerlink" title="Setup and Configure Universal Control Plane(UCP) and Docker Trusted Repository(DTR) for Secure Cluster Management"></a>Setup and Configure Universal Control Plane(UCP) and Docker Trusted Repository(DTR) for Secure Cluster Management</h3><h4 id="install-UCP"><a href="#install-UCP" class="headerlink" title="install UCP"></a>install UCP</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# docker container run --rm -it --name ucp -v /var/run/docker.sock:/var/run/docker.sock docker/ucp:2.2.4 install --host-address 172.31.22.17 --interactive</span><br><span class="line">Unable to find image &apos;docker/ucp:2.2.4&apos; locally</span><br><span class="line">2.2.4: Pulling from docker/ucp</span><br><span class="line">b56ae66c2937: Pull complete</span><br><span class="line">68de5ce90bd1: Pull complete</span><br><span class="line">d2de1fff8042: Pull complete</span><br><span class="line">Digest: sha256:2b819b92d2209c0a5680fcee3f99c1090a9d4f1e6fea3003a9a661cbd16cc851</span><br><span class="line">Status: Downloaded newer image for docker/ucp:2.2.4</span><br><span class="line">INFO[0000] Verifying your system is compatible with UCP 2.2.4 (168ec746e)</span><br><span class="line">INFO[0000] Your engine version 17.12.0-ce, build c97c6d6 (3.10.0-693.11.1.el7.x86_64) is compatible</span><br><span class="line">Admin Username: admin</span><br><span class="line">Admin Password:</span><br><span class="line">Confirm Admin Password:</span><br><span class="line">INFO[0053] Pulling required images... (this may take a while)</span><br><span class="line">INFO[0053] Pulling docker/ucp-agent:2.2.4</span><br><span class="line">INFO[0067] Pulling docker/ucp-auth:2.2.4</span><br><span class="line">INFO[0084] Pulling docker/ucp-dsinfo:2.2.4</span><br><span class="line">INFO[0135] Pulling docker/ucp-compose:2.2.4</span><br><span class="line">INFO[0160] Pulling docker/ucp-controller:2.2.4</span><br><span class="line">INFO[0176] Pulling docker/ucp-etcd:2.2.4</span><br><span class="line">INFO[0192] Pulling docker/ucp-cfssl:2.2.4</span><br><span class="line">INFO[0201] Pulling docker/ucp-metrics:2.2.4</span><br><span class="line">INFO[0209] Pulling docker/ucp-swarm:2.2.4</span><br><span class="line">INFO[0217] Pulling docker/ucp-auth-store:2.2.4</span><br><span class="line">INFO[0223] Pulling docker/ucp-hrm:2.2.4</span><br><span class="line">WARN[0229] None of the hostnames we&apos;ll be using in the UCP certificates [test1 127.0.0.1 172.17.0.1 172.31.22.17] contain a domain component.  Your generated certs may fail TLS validation unless you only use one of these shortnames or IPs to connect.  You can use the --san flag to add more aliases</span><br></pre></td></tr></table></figure>
<p>addtional aliaese</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Additional aliases: ucp.mytest.com</span><br><span class="line">INFO[0009] Establishing mutual Cluster Root CA with Swarm</span><br><span class="line">INFO[0012] Installing UCP with host address 172.31.22.17 - If this is incorrect, please specify an alternative address with the &apos;--host-address&apos; flag</span><br><span class="line">INFO[0012] Generating UCP Client Root CA</span><br><span class="line">INFO[0012] Deploying UCP Service</span><br><span class="line">INFO[0053] Installation completed on test1 (node umqocsykyg1xxsn6wvk4igx1k)</span><br><span class="line">INFO[0059] Installation completed on test2 (node rugmetip3d1il2cokfqt1bx03)</span><br><span class="line">INFO[0063] Installation completed on test3 (node zl4ujrl7uh38saoyu0r0i42pz)</span><br><span class="line">INFO[0063] UCP Instance ID: 5j843ntmj4xr8djib232rekze</span><br><span class="line">INFO[0063] UCP Server SSL: SHA-256 Fingerprint=83:50:09:06:1D:A0:3C:B5:D6:D4:99:BD:D1:83:71:60:C9:CD:F4:F5:14:AE:5B:9D:37:F9:F9:15:B6:01:80:A5</span><br><span class="line">INFO[0063] Login to UCP at https://172.31.22.17:443</span><br><span class="line">INFO[0063] Username: admin</span><br><span class="line">INFO[0063] Password: (your admin password)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                         COMMAND                  CREATED              STATUS                        PORTS                                                                             NAMES</span><br><span class="line">7dd45912f607        docker/ucp-agent:2.2.4        &quot;/bin/ucp-agent agent&quot;   About a minute ago   Up About a minute             2376/tcp                                                                          ucp-agent.umqocsykyg1xxsn6wvk4igx1k.gtmbpboifov5ggqf2im5qz2n9</span><br><span class="line">48a3e982d35a        docker/ucp-controller:2.2.4   &quot;/bin/controller ser…&quot;   About a minute ago   Up About a minute (healthy)   0.0.0.0:443-&gt;8080/tcp                                                             ucp-controller</span><br><span class="line">abc9f112aef1        docker/ucp-auth:2.2.4         &quot;/usr/local/bin/enzi…&quot;   About a minute ago   Up About a minute (healthy)   0.0.0.0:12385-&gt;4443/tcp                                                           ucp-auth-api</span><br><span class="line">67faa78d9df0        docker/ucp-metrics:2.2.4      &quot;/bin/entrypoint.sh …&quot;   About a minute ago   Up About a minute (healthy)   0.0.0.0:12387-&gt;12387/tcp                                                          ucp-metrics</span><br><span class="line">c6bb9064aaec        docker/ucp-swarm:2.2.4        &quot;/bin/swarm manage -…&quot;   About a minute ago   Up About a minute (healthy)   0.0.0.0:2376-&gt;2375/tcp                                                            ucp-swarm-manager</span><br><span class="line">df59324663aa        docker/ucp-auth:2.2.4         &quot;/usr/local/bin/enzi…&quot;   About a minute ago   Up About a minute (healthy)   0.0.0.0:12386-&gt;4443/tcp                                                           ucp-auth-worker</span><br><span class="line">bb818ffa3d7e        docker/ucp-auth-store:2.2.4   &quot;rethinkdb --bind al…&quot;   About a minute ago   Up About a minute (healthy)   0.0.0.0:12383-12384-&gt;12383-12384/tcp                                              ucp-auth-store</span><br><span class="line">38fbbd11781a        docker/ucp-etcd:2.2.4         &quot;/bin/etcd --data-di…&quot;   About a minute ago   Up About a minute (healthy)   2380/tcp, 4001/tcp, 7001/tcp, 0.0.0.0:12380-&gt;12380/tcp, 0.0.0.0:12379-&gt;2379/tcp   ucp-kv</span><br><span class="line">0cacfcca1d86        docker/ucp-cfssl:2.2.4        &quot;/bin/ucp-ca serve -…&quot;   About a minute ago   Up About a minute (healthy)   0.0.0.0:12381-&gt;12381/tcp                                                          ucp-cluster-root-ca</span><br><span class="line">c96b8588e400        docker/ucp-cfssl:2.2.4        &quot;/bin/ucp-ca serve -…&quot;   About a minute ago   Up About a minute (healthy)   0.0.0.0:12382-&gt;12382/tcp                                                          ucp-client-root-ca</span><br><span class="line">aec58234b750        docker/ucp-agent:2.2.4        &quot;/bin/ucp-agent prox…&quot;   About a minute ago   Up About a minute (healthy)   0.0.0.0:12376-&gt;2376/tcp                                                           ucp-proxy</span><br></pre></td></tr></table></figure>
<p>UCP web site 접속</p>
<p><img src="./images/docker1.PNG" alt="images"></p>
<p>license는 스킵</p>
<p><img src="C:\Users\SKTelecom\Documents\images\docker2.PNG" alt="docker2"></p>
<p>login을 하게 되면 UCP의 Dashboard 화면을 볼 수 있다.</p>
<p>node 수라던지 images 개수, Container의 현황등 여러  확인 할 수 있다.</p>
<p><img src="C:\Users\SKTelecom\Documents\images\docker3.PNG" alt="docker3"></p>
<p>woker node들에서 container 현황을 보면 UCP agent 들이 실행되어 있는 것을 확인 할 수 있다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[user@test3 ~]$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE                    COMMAND                  CREATED             STATUS                       PORTS                     NAMES</span><br><span class="line">0a03ad0b88b8        docker/ucp-agent:2.2.4   &quot;/bin/ucp-agent agent&quot;   39 seconds ago      Up 34 seconds                2376/tcp                  ucp-agent.zl4ujrl7uh3</span><br><span class="line">8saoyu0r0i42pz.k3ecm199utjg99a5k1dfefccq</span><br><span class="line">eeae90c5eed8        docker/ucp-agent:2.2.4   &quot;/bin/ucp-agent prox…&quot;   About an hour ago   Up About an hour (healthy)   0.0.0.0:12376-&gt;2376/tcp   ucp-proxy</span><br></pre></td></tr></table></figure>
<p>아 이제 DTR (Docker Trusted Registry)를 셋업할 준비를 하자</p>
<p>UCP의 왼쪽 네비게이션 메뉴중에 admin -&gt; admin Settings로 들어간다.</p>
<p><img src="C:\Users\SKTelecom\Documents\images\docker4.PNG" alt="docker4"></p>
<p>다시 왼쪽 네이비게이션 메뉴에서 Docker Trusted Registry 메뉴를 선택하면 오른쪽 화면에 관련 설정을 할 수 있는 메뉴들이 나온다.</p>
<p>DTR 서비스를 제공할 Node를 선택한다. 여기서는 test2로 지정했다</p>
<p>TLS 인증은 disable 한다. </p>
<p>설정을 완료하면 하단부에 수행 해야할 command line 명령어가 생성 되면 copy to clipboard 버튼을 클릭하여 클립보드로 명령어 라인을 copy한다 </p>
<p><img src="C:\Users\SKTelecom\Documents\images\docker5.PNG" alt="docker5"></p>
<p>다시 UCP 서버인 test1의 command line에서 copy한 command를 아래와 같이 수행 한다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# docker run -it --rm docker/dtr install  --ucp-node test2  --ucp-username admin  --ucp-url https://ucp.mytest.com  --ucp-insecure-tls</span><br><span class="line"></span><br><span class="line">INFO[0000] Beginning Docker Trusted Registry installation </span><br><span class="line">ucp-password: </span><br><span class="line">INFO[0003] Validating UCP cert                          </span><br><span class="line">INFO[0003] Connecting to UCP                            </span><br><span class="line">INFO[0004] The UCP cluster contains the following nodes without port conflicts: test2, test3 </span><br><span class="line">INFO[0004] Searching containers in UCP for DTR replicas </span><br><span class="line">INFO[0004] Searching containers in UCP for DTR replicas </span><br><span class="line">INFO[0004] verifying [80 443] ports on test2            </span><br><span class="line">INFO[0010] starting phase 2                             </span><br><span class="line">INFO[0000] Validating UCP cert                          </span><br><span class="line">INFO[0000] Connecting to UCP                            </span><br><span class="line">INFO[0000] Verifying your system is compatible with DTR </span><br><span class="line">INFO[0000] Checking if the node is okay to install on   </span><br><span class="line">INFO[0000] Creating network: dtr-ol                     </span><br><span class="line">INFO[0000] Connecting to network: dtr-ol                </span><br><span class="line">INFO[0000] Waiting for phase2 container to be known to the Docker daemon </span><br><span class="line">INFO[0000] Starting UCP connectivity test               </span><br><span class="line">INFO[0000] UCP connectivity test passed                 </span><br><span class="line">INFO[0000] Setting up replica volumes...                </span><br><span class="line">INFO[0001] Creating initial CA certificates             </span><br><span class="line">INFO[0001] Bootstrapping rethink...                     </span><br><span class="line">INFO[0001] Creating dtr-rethinkdb-993d3a693f09...       </span><br><span class="line">INFO[0029] Establishing connection with Rethinkdb       </span><br><span class="line">INFO[0030] Waiting for database dtr2 to exist           </span><br><span class="line">INFO[0030] Establishing connection with Rethinkdb       </span><br><span class="line">INFO[0034] Generated TLS certificate.                    dnsNames=[*.com *.*.com example.com *.dtr *.*.dtr] domains=[*.com *.*.com 172.17.0.1 example.com *.dtr *.*.dt</span><br><span class="line">r] ipAddresses=[172.17.0.1]</span><br><span class="line">INFO[0035] License config not copied from UCP because UCP has no valid license. </span><br><span class="line">INFO[0035] Migrating db...                              </span><br><span class="line">INFO[0000] Establishing connection with Rethinkdb       </span><br><span class="line">INFO[0000] Migrating database schema                     fromVersion=0 toVersion=8</span><br><span class="line">INFO[0004] Waiting for database notaryserver to exist   </span><br><span class="line">INFO[0005] Waiting for database notarysigner to exist   </span><br><span class="line">INFO[0005] Waiting for database jobrunner to exist      </span><br><span class="line">INFO[0007] Migrated database from version 0 to 8        </span><br><span class="line">INFO[0042] Starting all containers...                   </span><br><span class="line">INFO[0042] Getting container configuration and starting containers... </span><br><span class="line">INFO[0043] Recreating dtr-rethinkdb-993d3a693f09...     </span><br><span class="line">INFO[0048] Creating dtr-registry-993d3a693f09...        </span><br><span class="line">INFO[0065] Creating dtr-garant-993d3a693f09...          </span><br><span class="line">INFO[0090] Creating dtr-api-993d3a693f09...             </span><br><span class="line">INFO[0116] Creating dtr-notary-server-993d3a693f09...   </span><br><span class="line">INFO[0135] Recreating dtr-nginx-993d3a693f09...         </span><br><span class="line">INFO[0160] Creating dtr-jobrunner-993d3a693f09...       </span><br><span class="line">INFO[0203] Creating dtr-notary-signer-993d3a693f09...   </span><br><span class="line">INFO[0211] Creating dtr-scanningstore-993d3a693f09...   </span><br><span class="line">INFO[0221] Trying to get the kv store connection back after reconfigure </span><br><span class="line">INFO[0221] Establishing connection with Rethinkdb       </span><br><span class="line">INFO[0222] Verifying auth settings...                   </span><br><span class="line">INFO[0222] Successfully registered dtr with UCP         </span><br><span class="line">INFO[0222] Establishing connection with Rethinkdb       </span><br><span class="line">INFO[0223] Background tag migration started             </span><br><span class="line">INFO[0223] Installation is complete                     </span><br><span class="line">INFO[0223] Replica ID is set to: 993d3a693f09           </span><br><span class="line">INFO[0223] You can use flag &apos;--existing-replica-id 993d3a693f09&apos; when joining other replicas to your Docker Trusted Registry Cluster</span><br></pre></td></tr></table></figure>
<p>인스톨이 끝났으면 container 현황을 확인하면 DTR에 관련된 여러 container가 수행중인것을 확인 할 수 있다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@test2 ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                            COMMAND                  CREATED              STATUS                       PORTS                                 </span><br><span class="line">     NAMES</span><br><span class="line">c13dac6b7678        docker/ucp-agent:2.2.4           &quot;/bin/ucp-agent agent&quot;   8 seconds ago        Up 2 seconds                 2376/tcp                              </span><br><span class="line">     ucp-agent.rugmetip3d1il2cokfqt1bx03.jltaf9xeqb7cs00jd5uyeywop</span><br><span class="line">c78ce0d67529        docker/dtr-postgres:2.4.1        &quot;/bin/postgreswrapper&quot;   31 seconds ago       Up 29 seconds                5432/tcp                              </span><br><span class="line">     dtr-scanningstore-993d3a693f09</span><br><span class="line">d09e4f033da9        docker/dtr-notary-signer:2.4.1   &quot;/start.sh&quot;              41 seconds ago       Up 39 seconds                                                      </span><br><span class="line">     dtr-notary-signer-993d3a693f09</span><br><span class="line">b00889f09c53        docker/dtr-jobrunner:2.4.1       &quot;/bin/jobrunner work…&quot;   50 seconds ago       Up 48 seconds                                                      </span><br><span class="line">     dtr-jobrunner-993d3a693f09</span><br><span class="line">03106001a3e6        docker/dtr-nginx:2.4.1           &quot;/bin/nginxwrapper&quot;      About a minute ago   Up 28 seconds                0.0.0.0:80-&gt;80/tcp, 0.0.0.0:443-&gt;443/t</span><br><span class="line">cp   dtr-nginx-993d3a693f09</span><br><span class="line">d73ede5a13cc        docker/dtr-notary-server:2.4.1   &quot;/start.sh&quot;              About a minute ago   Up About a minute                                                  </span><br><span class="line">     dtr-notary-server-993d3a693f09</span><br><span class="line">a95c142f6ee2        docker/dtr-api:2.4.1             &quot;/bin/api&quot;               2 minutes ago        Up 2 minutes                                                       </span><br><span class="line">     dtr-api-993d3a693f09</span><br><span class="line">1876fd8f345b        docker/dtr-garant:2.4.1          &quot;/bin/garant&quot;            2 minutes ago        Up 2 minutes                                                       </span><br><span class="line">     dtr-garant-993d3a693f09</span><br><span class="line">a4e11b70ff64        docker/dtr-registry:2.4.1        &quot;/bin/registry&quot;          3 minutes ago        Up 3 minutes                                                       </span><br><span class="line">     dtr-registry-993d3a693f09</span><br><span class="line">492d36ae37aa        docker/dtr-rethink:2.4.1         &quot;/bin/rethinkwrapper&quot;    3 minutes ago        Up 3 minutes                                                       </span><br><span class="line">     dtr-rethinkdb-993d3a693f09</span><br><span class="line">3250066f27ce        docker/ucp-agent:2.2.4           &quot;/bin/ucp-agent prox…&quot;   About an hour ago    Up About an hour (healthy)   0.0.0.0:12376-&gt;2376/tcp               </span><br><span class="line">     ucp-proxy</span><br></pre></td></tr></table></figure>
<p>자 이제 dtr.mytest.com으로 접속해보자</p>
<p>접속하는 과정은 UCP와 동일하다</p>
<p><img src="C:\Users\SKTelecom\Documents\images\docker6.PNG" alt="docker6"></p>
<p><img src="C:\Users\SKTelecom\Documents\images\docker7.PNG" alt="docker7"></p>
<p>Docker Repository 관리 화면을 볼 수 있다.</p>
<h3 id="Backup-UCP-amp-DTR"><a href="#Backup-UCP-amp-DTR" class="headerlink" title="Backup UCP &amp; DTR"></a>Backup UCP &amp; DTR</h3><p>d</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# docker container run --log-driver none --rm -i --name ucp -v /var/run/docker.sock:/var/run/docker.sock docker/ucp backup &gt; backup.tar</span><br><span class="line">INFO[0000] Your engine version 17.12.0-ce, build c97c6d6 (3.10.0-693.11.1.el7.x86_64) is compatible</span><br><span class="line">INFO[0000] We detected local components of UCP instance 5j843ntmj4xr8djib232rekze</span><br><span class="line">FATA[0000] re-run the command with &quot;--id 5j843ntmj4xr8djib232rekze&quot; or --interactive to confirm you want to backup this UCP instance</span><br></pre></td></tr></table></figure>
<p>위와 같은 에러가 발생하는 이유는 id 가 지정되지 않아서 인데, error 메시지의 id 값을 copy하여 다시 수행한다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# docker container run --log-driver none --rm -i --name ucp -v /var/run/docker.sock:/var/run/docker.sock docker/ucp backup --id 5j843ntmj4xr8djib232rekze &gt; backup.tar</span><br><span class="line">INFO[0000] Your engine version 17.12.0-ce, build c97c6d6 (3.10.0-693.11.1.el7.x86_64) is compatible</span><br><span class="line">INFO[0000] Temporarily stopping local UCP containers to ensure a consistent backup</span><br><span class="line">INFO[0061] Backing up internal KV store</span><br><span class="line">INFO[0000] Beginning backup</span><br><span class="line">WARN[0000] Unable to copy license file from UCP controller container - continuing without license backup: Error response from daemon: Could not find the file /etc/ucp/docker.lic in container 48a3e982d35ac13d6596e24f75c6a285fd33eba8c7b0274f817bdf0dc6028866</span><br><span class="line">INFO[0001] Backup completed successfully</span><br><span class="line">INFO[0066] Resuming stopped UCP containers</span><br></pre></td></tr></table></figure>
<p>ucp에 관련된 모든 내용들이 backup.tar로 백업되었고 용량은 171MB 가 되는 것을 확인할 수 있다. backup command를 clone job에 등록해서 정기적으로 UCP 내용을 백업 받는 것을 권장한다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# ls -lsh</span><br><span class="line">total 2.2G</span><br><span class="line">171M -rw-r--r--. 1 root root 171M Jan  7 13:26 backup.tar</span><br><span class="line">2.0G -rw-r--r--. 1 root root 2.0G Jan  7  2015 swap</span><br><span class="line">   0 drwx------. 5 root root   90 Jan  7 07:09 swarm</span><br><span class="line">100K -rw-r--r--. 1 root root  97K Jan  7 07:15 swarm_backup_20171010.tar.gz</span><br></pre></td></tr></table></figure>
<p>그러면 Restore를 어떻게 할까? 단순하다 아래와 같이 백업된 파일을 대상으로 Restore하는 명령으로 수행 할 수 있다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# docker container run --log-driver none --rm -i --name ucp -v /var/run/docker.sock:/var/run/docker.sock docker/ucp restore --id 5j843ntmj4xr8djib232rekze &lt; backup.tar</span><br></pre></td></tr></table></figure>
<h4 id="Backup-DTR"><a href="#Backup-DTR" class="headerlink" title="Backup DTR"></a>Backup DTR</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@test2 ~]# docker run -i --rm docker/dtr backup --ucp-insecure-tls --ucp-url https://dtr.mytest.com:443 --ucp-username admin --ucp-password password</span><br><span class="line">hadk &gt; dtr-backup.tar</span><br><span class="line">INFO[0000] Validating UCP cert                          </span><br><span class="line">INFO[0000] Connecting to UCP                            </span><br><span class="line">INFO[0000] Searching containers in UCP for DTR replicas </span><br><span class="line">INFO[0000] This cluster contains the replicas: 993d3a693f09 </span><br><span class="line">Choose a replica to back up from [993d3a693f09]: </span><br><span class="line">INFO[0000] Validating UCP cert                          </span><br><span class="line">INFO[0000] Connecting to UCP                            </span><br><span class="line">INFO[0000] Connecting to network: dtr-ol                </span><br><span class="line">INFO[0000] Waiting for phase2 container to be known to the Docker daemon </span><br><span class="line">INFO[0000] Establishing connection with Rethinkdb       </span><br><span class="line">INFO[0000] Backing up DTR                               </span><br><span class="line">INFO[0000] Establishing connection with Rethinkdb       </span><br><span class="line">INFO[0011] Backup complete.</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@test2 ~]# ls -lsh</span><br><span class="line">total 2.1G</span><br><span class="line"> 92K -rw-r--r--. 1 root root  92K Jan  7 13:39 dtr-backup.tar</span><br><span class="line">2.0G -rw-r--r--. 1 root root 2.0G Jan  7  2015 swap</span><br></pre></td></tr></table></figure>
<p>restore</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@test2 ~]# docker run -i --rm docker/dtr restore --ucp-insecure-tls --ucp-url https://dtr.mytest.com:443 --ucp-username admin --ucp-password password</span><br><span class="line">hadk &gt; dtr-backup.tar</span><br></pre></td></tr></table></figure>
<h3 id="Add-User"><a href="#Add-User" class="headerlink" title="Add User"></a>Add User</h3><p><img src="C:\Users\SKTelecom\Documents\images\docker8.PNG" alt="docker8"></p>
<p><img src="C:\Users\SKTelecom\Documents\images\docker9.PNG" alt="docker9"></p>
<p><img src="C:\Users\SKTelecom\Documents\images\docker10.PNG" alt="docker10"></p>
<p><img src="C:\Users\SKTelecom\Documents\images\docker11.PNG" alt="docker11"></p>
<p><img src="C:\Users\SKTelecom\Documents\images\docker12.PNG" alt="docker12"></p>
<p><img src="C:\Users\SKTelecom\Documents\images\docker13.PNG" alt="docker13"></p>
<p><img src="C:\Users\SKTelecom\Documents\images\docker14.PNG" alt="docker14"></p>
<p><img src="C:\Users\SKTelecom\Documents\images\docker15.PNG" alt="docker15"></p>
<h3 id="Docker-and-Name-spaces"><a href="#Docker-and-Name-spaces" class="headerlink" title="Docker and Name spaces"></a>Docker and Name spaces</h3><h4 id="Namespace-Types"><a href="#Namespace-Types" class="headerlink" title="Namespace Types"></a>Namespace Types</h4><ul>
<li>Process ID</li>
<li>Mount</li>
<li>IPC</li>
<li>User(currently experimental support for)</li>
<li>Networks</li>
</ul>
<h4 id="Docker-and-Control-Groups-cgroups"><a href="#Docker-and-Control-Groups-cgroups" class="headerlink" title="Docker and Control Groups(cgroups)"></a>Docker and Control Groups(cgroups)</h4><h4 id="Common-control-Groups"><a href="#Common-control-Groups" class="headerlink" title="Common control Groups"></a>Common control Groups</h4><ul>
<li>CPU</li>
<li>Memory</li>
<li>Network Bandwidth</li>
<li>Disk</li>
<li>Priority</li>
</ul>

        </div>
        <footer class="article-footer">
            



    <a data-url="http://yoursite.com/2018/08/13/docker1-1/" data-id="cjkruh2pp0001l0q8zvih55sk" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>


                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>follow:</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="twitter" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-twitter"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="facebook" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-facebook"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/ppoffice/hexo-theme-hueman" target="_blank" rel="noopener">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="rss" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
    
    <div class="widgets-container">
        
            
                

            
                
    <div class="widget-wrap">
        <h3 class="widget-title">recents</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/08/13/docker1-1/" class="thumbnail">
    
    
        <span style="background-image:url(./images/docker1.PNG)" alt="docker1" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Container/">Container</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/categories/Container/Docker/">Docker</a></p>
                            <p class="item-title"><a href="/2018/08/13/docker1-1/" class="title">docker1</a></p>
                            <p class="item-date"><time datetime="2018-08-13T04:40:12.000Z" itemprop="datePublished">2018-08-13</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">categories</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Container/">Container</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Container/Docker/">Docker</a><span class="category-list-count">1</span></li></ul></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">1</span></li></ul>
        </div>
    </div>


            
                

            
                

            
        
    </div>
</aside>

                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2018 Alan Kim</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
            </div>
            <div class="footer-plugins">
              
    


            </div>
        </div>
    </div>
</footer>

        
    
    <script>
    var disqus_shortname = 'hexo-theme-hueman';
    
    
    var disqus_url = 'http://yoursite.com/2018/08/13/docker1-1/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>
